<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced CADENCE - Hyper-Personalized Search Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .search-section {
            margin-bottom: 40px;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 20px 25px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 1.2rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .user-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
        }

        .control-group input, .control-group select {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .control-group input:focus, .control-group select:focus {
            border-color: #667eea;
        }

        .suggestions-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            min-height: 150px;
            border: 2px solid #e0e0e0;
        }

        .suggestions-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .suggestion-item {
            background: white;
            padding: 12px 18px;
            margin: 8px 0;
            border-radius: 25px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestion-item:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .suggestion-rank {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .products-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .product-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ffa500;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .personalization-badge {
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .no-personalization-badge {
            background: #ef4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
        }

        .demo-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .response-time {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .user-controls {
                flex-direction: column;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Enhanced CADENCE</h1>
            <p>Hyper-Personalized E-commerce Search & Recommendations</p>
        </div>

        <div class="main-content">
            <!-- Stats Section -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value" id="totalQueries">0</div>
                    <div class="stat-label">Total Queries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgResponseTime">0ms</div>
                    <div class="stat-label">Avg Response Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="personalizationRate">0%</div>
                    <div class="stat-label">Personalization Rate</div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="demo-section">
                <div class="demo-title">üîç Hyper-Personalized Autosuggest</div>
                
                <div class="user-controls">
                    <div class="control-group">
                        <label for="userId">User ID:</label>
                        <input type="text" id="userId" value="demo_user_001" placeholder="Enter user ID">
                    </div>
                    <div class="control-group">
                        <label for="sessionId">Session:</label>
                        <input type="text" id="sessionId" value="" placeholder="Auto-generated">
                    </div>
                    <div class="control-group">
                        <label for="maxSuggestions">Max Suggestions:</label>
                        <select id="maxSuggestions">
                            <option value="5">5</option>
                            <option value="8" selected>8</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="personalizationEnabled">
                            <input type="checkbox" id="personalizationEnabled" checked>
                            Enable Personalization
                        </label>
                    </div>
                </div>

                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="Start typing your search query... (e.g., 'laptop', 'shoes', 'phone')" 
                           autocomplete="off">
                </div>

                <div class="suggestions-container">
                    <div class="suggestions-title">
                        üí° Smart Suggestions
                        <span id="suggestionsBadge" class="personalization-badge" style="display: none;">Personalized</span>
                    </div>
                    <div id="suggestionsContent">
                        <div style="color: #666; text-align: center; padding: 20px;">
                            Type in the search box above to see personalized suggestions...
                        </div>
                    </div>
                    <div class="response-time" id="suggestionsResponseTime"></div>
                </div>
            </div>

            <!-- Product Search Section -->
            <div class="demo-section">
                <div class="demo-title">üõçÔ∏è Personalized Product Search</div>
                
                <div style="margin-bottom: 20px;">
                    <button class="button" onclick="searchProducts()">Search Products</button>
                    <span style="margin-left: 15px; color: #666;">
                        Click to search for products based on your current query
                    </span>
                </div>

                <div class="products-container">
                    <div class="suggestions-title">
                        üéØ Personalized Results
                        <span id="productsBadge" class="personalization-badge" style="display: none;">Reranked</span>
                    </div>
                    <div id="productsContent">
                        <div style="color: #666; text-align: center; padding: 20px;">
                            Enter a search query and click "Search Products" to see personalized results...
                        </div>
                    </div>
                    <div class="response-time" id="productsResponseTime"></div>
                </div>
            </div>

            <!-- Engagement Simulation -->
            <div class="demo-section">
                <div class="demo-title">üìä User Engagement Simulation</div>
                <p style="margin-bottom: 15px; color: #666;">
                    Simulate user interactions to see how personalization improves over time:
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="button" onclick="simulateEngagement('view')">üëÅÔ∏è View</button>
                    <button class="button" onclick="simulateEngagement('click')">üëÜ Click</button>
                    <button class="button" onclick="simulateEngagement('add_to_cart')">üõí Add to Cart</button>
                    <button class="button" onclick="simulateEngagement('wishlist')">‚ù§Ô∏è Wishlist</button>
                    <button class="button" onclick="simulateEngagement('purchase')">üí∞ Purchase</button>
                </div>
                <div id="engagementFeedback" style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 10px; display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentSessionId = '';
        let totalQueries = 0;
        let responseTimes = [];
        let personalizedQueries = 0;
        let lastQuery = '';

        // Initialize session
        function initializeSession() {
            currentSessionId = 'session_' + Math.random().toString(36).substr(2, 9);
            document.getElementById('sessionId').value = currentSessionId;
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalQueries').textContent = totalQueries;
            
            if (responseTimes.length > 0) {
                const avgTime = Math.round(responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length);
                document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
            }
            
            const personalizationRate = totalQueries > 0 ? Math.round((personalizedQueries / totalQueries) * 100) : 0;
            document.getElementById('personalizationRate').textContent = personalizationRate + '%';
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Get autosuggest
        async function getAutosuggest(query) {
            if (!query.trim()) {
                document.getElementById('suggestionsContent').innerHTML = 
                    '<div style="color: #666; text-align: center; padding: 20px;">Type in the search box above to see personalized suggestions...</div>';
                return;
            }

            // Show loading
            document.getElementById('suggestionsContent').innerHTML = 
                '<div class="loading"><div class="spinner"></div>Loading suggestions...</div>';

            try {
                const startTime = Date.now();
                
                const response = await fetch('/autosuggest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query_prefix: query,
                        user_id: document.getElementById('userId').value,
                        session_id: currentSessionId,
                        max_suggestions: parseInt(document.getElementById('maxSuggestions').value),
                        include_personalization: document.getElementById('personalizationEnabled').checked
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                // Update stats
                totalQueries++;
                responseTimes.push(responseTime);
                if (data.personalized) personalizedQueries++;
                updateStats();

                // Display suggestions
                let suggestionsHtml = '';
                data.suggestions.forEach((suggestion, index) => {
                    suggestionsHtml += `
                        <div class="suggestion-item" onclick="selectSuggestion('${suggestion}', ${index + 1})">
                            <span>${suggestion}</span>
                            <span class="suggestion-rank">${index + 1}</span>
                        </div>
                    `;
                });

                document.getElementById('suggestionsContent').innerHTML = suggestionsHtml;
                
                // Update badge
                const badge = document.getElementById('suggestionsBadge');
                badge.style.display = 'inline';
                if (data.personalized) {
                    badge.className = 'personalization-badge';
                    badge.textContent = 'Personalized';
                } else {
                    badge.className = 'no-personalization-badge';
                    badge.textContent = 'Generic';
                }

                // Update response time
                document.getElementById('suggestionsResponseTime').textContent = 
                    `Response time: ${responseTime}ms`;

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('suggestionsContent').innerHTML = 
                    '<div style="color: #ef4444; text-align: center; padding: 20px;">Error loading suggestions. Please try again.</div>';
            }
        }

        // Select suggestion
        async function selectSuggestion(suggestion, rank) {
            document.getElementById('searchInput').value = suggestion;
            lastQuery = suggestion;
            
            // Log engagement
            await logEngagement('click', suggestion, rank);
            
            // Get new suggestions for the selected query
            getAutosuggest(suggestion);
        }

        // Search products
        async function searchProducts() {
            const query = document.getElementById('searchInput').value.trim() || lastQuery;
            
            if (!query) {
                alert('Please enter a search query first');
                return;
            }

            // Show loading
            document.getElementById('productsContent').innerHTML = 
                '<div class="loading"><div class="spinner"></div>Loading products...</div>';

            try {
                const startTime = Date.now();
                
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        user_id: document.getElementById('userId').value,
                        session_id: currentSessionId,
                        max_results: 12,
                        include_personalization: document.getElementById('personalizationEnabled').checked
                    })
                });

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                // Display products
                let productsHtml = '<div class="product-grid">';
                data.products.forEach(product => {
                    productsHtml += `
                        <div class="product-card" onclick="selectProduct('${product.product_id}')">
                            <div class="product-title">${product.title}</div>
                            <div class="product-meta">
                                <div class="product-price">$${product.price ? product.price.toFixed(2) : 'N/A'}</div>
                                <div class="product-rating">
                                    ‚≠ê ${product.rating ? product.rating.toFixed(1) : 'N/A'}
                                </div>
                            </div>
                        </div>
                    `;
                });
                productsHtml += '</div>';

                document.getElementById('productsContent').innerHTML = productsHtml;
                
                // Update badge
                const badge = document.getElementById('productsBadge');
                badge.style.display = 'inline';
                if (data.personalized) {
                    badge.className = 'personalization-badge';
                    badge.textContent = 'Reranked';
                } else {
                    badge.className = 'no-personalization-badge';
                    badge.textContent = 'Generic';
                }

                // Update response time
                document.getElementById('productsResponseTime').textContent = 
                    `Response time: ${responseTime}ms ‚Ä¢ ${data.total_results} products`;

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('productsContent').innerHTML = 
                    '<div style="color: #ef4444; text-align: center; padding: 20px;">Error loading products. Please try again.</div>';
            }
        }

        // Select product
        async function selectProduct(productId) {
            await logEngagement('view', productId, 1);
        }

        // Log engagement
        async function logEngagement(actionType, itemId, rank = 1) {
            try {
                const response = await fetch('/engagement', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: document.getElementById('userId').value,
                        session_id: currentSessionId,
                        action_type: actionType,
                        item_id: itemId,
                        item_rank: rank,
                        duration_seconds: Math.random() * 30 + 5, // Random duration
                        additional_data: {}
                    })
                });

                const data = await response.json();
                console.log('Engagement logged:', data);
                
            } catch (error) {
                console.error('Error logging engagement:', error);
            }
        }

        // Simulate engagement
        async function simulateEngagement(actionType) {
            const actions = {
                'view': 'üëÅÔ∏è Viewed product',
                'click': 'üëÜ Clicked on suggestion',
                'add_to_cart': 'üõí Added to cart',
                'wishlist': '‚ù§Ô∏è Added to wishlist',
                'purchase': 'üí∞ Made purchase'
            };

            await logEngagement(actionType, `demo_item_${Date.now()}`, Math.floor(Math.random() * 5) + 1);
            
            const feedback = document.getElementById('engagementFeedback');
            feedback.style.display = 'block';
            feedback.innerHTML = `<strong>‚úÖ ${actions[actionType]}</strong> - This interaction will improve your future recommendations!`;
            
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }

        // Setup event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeSession();
            
            const searchInput = document.getElementById('searchInput');
            const debouncedAutosuggest = debounce(getAutosuggest, 300);
            
            searchInput.addEventListener('input', function(e) {
                debouncedAutosuggest(e.target.value);
            });

            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProducts();
                }
            });
        });
    </script>
</body>
</html> 